# Power Consumption EDA & ML for Tetuan City

## 1. Описание данных

- **Источник:** Tetuan City power consumption.csv (Тетуан, Марокко)
- **Размер:** 52 416 строк (почасовые данные за год, интервал 10 минут)
- **Признаки:**
  - `DateTime` — временная метка
  - `Temperature` — температура (°C), среднее: **18.81**, min: **3.25**, max: **40.01**
  - `Humidity` — влажность (%), среднее: **68.26**, min: **11.34**, max: **94.80**
  - `Wind Speed` — скорость ветра (м/с), среднее: **1.96**, min: **0.05**, max: **6.48**
  - `general diffuse flows` — среднее: **182.70**, max: **1163**
  - `diffuse flows` — среднее: **75.03**, max: **936**
  - `Zone 1 Power Consumption` — потребление (кВт⋅ч), среднее: **32 344.97**, min: **13 895.70**, max: **52 204.40**

**Цель:** Прогноз потребления Zone 1 по погодным и временным признакам.

---

## 2. Исследовательский анализ данных (EDA)

Для понимания структуры и особенностей данных были построены следующие графики:

- **Гистограммы распределений** для всех признаков, чтобы выявить скошенность и выбросы.
- **Временные ряды** для скорости ветра и потребления энергии — позволили увидеть суточную и сезонную цикличность.
- **Тепловая карта** потребления: ось X — час дня, ось Y — день недели, цвет — среднее потребление. Это выявило пики нагрузки и закономерности.
- **Lineplot месячного потребления**: тренд по месяцам, чтобы увидеть сезонные скачки (лето — максимум, зима — минимум).
- **Scatter-графики** для аномальных режимов скорости ветра.

**Ключевые выводы:**
- Температура и потребление — близки к нормальному распределению.
- Потоки солнечного излучения — сильная скошенность вправо (логарифмирование обязательно).
- `Wind Speed` — два режима ("низкая" 0.07–0.09 м/с — **49.3%**, "высокая" 4.9–5.0 м/с — **38.5%**), между ними мало промежуточных значений.
- Сезонные пики потребления: июль-август (**36 435 кВт⋅ч**), минимумы — ноябрь-декабрь (~**29 000 кВт⋅ч**).

---

## 3. Feature Engineering

**Мотивация выбора признаков:**
- Для учета цикличности времени созданы признаки:
  - `Hour_sin`, `Hour_cos` — позволяют моделям видеть круговую природу часов.
  - `Day of Week`, `Month` — для выявления недельных и сезонных трендов.
- Логарифмирование переменных с сильной скошенностью (`general diffuse flows`, `diffuse flows`, `Zone 1 Power Consumption`): чтобы улучшить работу линейных моделей и уменьшить влияние выбросов.
- Категоризация `Wind Speed` на два режима:
  - Причина: по графикам видно, что значения "залипают" в двух диапазонах (почти дискретно), стандартные методы неадекватны.
  - Добавлен бинарный признак `Wind_Mode`.
- Масштабирование (StandardScaler/MinMaxScaler) — для признаков с большой амплитудой (потоки, температура).
- Удалены переменные, не влияющие на целевой показатель (например, потребление в других зонах).

**Примеры кода из ноутбука:**
```python
df['Hour_sin'] = np.sin(2 * np.pi * df['Hour'] / 24)
df['Hour_cos'] = np.cos(2 * np.pi * df['Hour'] / 24)
df['general diffuse flows'] = np.log1p(df['general diffuse flows'])
df['diffuse flows'] = np.log1p(df['diffuse flows'])
df['Wind_Mode'] = np.where(df['Wind Speed'] < 1, 'Low', 'High')
```

---

## 4. Моделирование и оценка моделей

**Подготовка:**
- Данные разбиты на train/test с учетом временного порядка (чтобы избежать утечек).
- Признаки масштабированы.

**Модели:**
- **Линейная регрессия:** базовый подход, дает R² ~ **0.79**.
- **Random Forest:** ансамблевая модель, хорошо работает с нелинейностями.  
  - Лучшие метрики на логарифмированной целевой переменной:
    - MAE: **4.02\% (1262.40)**
    - MSE: **3334460.30**
    - RMSE: **5.79\% (1826.05)**
    - R²: **≈ 0.9329**


**Оценка:**
- Использованы метрики R², MAE, RMSE.
- Визуализированы ошибки (residuals).
- Сравнение моделей показало: ансамблевые методы (Random Forest, бустинг) значительно лучше линейных моделей, особенно после feature engineering.

---

## 5. Итоговые выводы и рекомендации

- Прогнозирование потребления Zone 1 становится точнее за счет логарифмирования и использования временных признаков.
- Наилучшие результаты — ансамблевые модели: Random Forest показал R² = **0.93**.
- Временные и погодные признаки — ключевые для прогноза; категоризация скорости ветра позволяет моделям лучше учитывать аномалии.
- Для дальнейшего улучшения рекомендуется:
  - Добавить новые погодные признаки (например, атмосферное давление).
  - Использовать кросс-валидацию по времени (TimeSeriesSplit).
  - Пробовать дополнительные ML-алгоритмы.

---

## Визуализации в ноутбуке

- Гистограммы и боксплоты для анализа распределения признаков и выбросов.
- Тепловая карта потребления по дням недели и часам.
- Линейные графики сезонности потребления и скорости ветра.
- Scatter-графики для режимов скорости ветра.

---

## Пример запуска ноутбука

1. Скачайте датасет `Tetuan City power consumption.csv` и поместите в корень проекта.
2. Запустите ноутбук `tetuan_city_power_consumption.ipynb`.
3. Следуйте этапам: EDA → Feature Engineering → Моделирование → Оценка.

---

## Контакты

Автор: [mindcoree](https://github.com/mindcoree)